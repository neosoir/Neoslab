services:

  ollama:
    image: ollama/ollama:latest
    container_name: ctr_chat_api_ollama
    restart: unless-stopped
    environment:
      - OLLAMA_ORIGINS=${APP_URL}
      - OLLAMA_CONTEXT_LENGTH=8192  
    ports:
      - "11434:11434"
    volumes:
      - vol_chat_ollama:/root/.ollama
    deploy:
      resources:
        limits:
          cpus: "2.0"
          memory: "8GB"
    networks:
    - net_neoslab

  client:
    build:
      context: ./client
      dockerfile: Dockerfile
    container_name: ctr_chat_client
    image: img_chat_client:1.0
    depends_on:
      - ollama
    ports:
      - "5173:5173" 
    volumes:
      - ./client:/client:rw,uid=1000,gid=1000 
    environment:
      - VITE_OLLAMA_API_URL=${VITE_OLLAMA_API_URL}
      - VITE_OLLAMA_CONTEXT=${VITE_OLLAMA_CONTEXT}
    networks:
    - net_neoslab

  nginx:
    image: nginx:1.27
    restart: always
    container_name: ctr_reverse_proxy
    ports:
      - "80:80" 
    volumes:
      - ./app:/var/www/html:ro
      - ./Docker.dev/nginx.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - client
      - ollama
    networks:
      - net_neoslab
      
volumes:
  vol_chat_ollama:
    name: vol_chat_ollama
    driver: local

networks:
  net_neoslab:
    name: net_neoslab
    driver: bridge

